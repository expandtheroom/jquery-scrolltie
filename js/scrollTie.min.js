!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(b,c,d){this.id=c.id,this.el="string"==typeof b?document.querySelector(b):b,this.$el=a(b),this.container=c.container?this.$el.parents(c.container)[0]:d,this.animateWhenOutOfView=c.animateWhenOutOfView,this.evt=c.evt||"scroll",this.context=c.context||f,this.property=-1!==i.indexOf(c.property)?"transform":c.property,this.property=-1!==j.indexOf(c.property)?"backgroundPosition":this.property,this.transform="transform"===this.property?c.property:null,this.backgroundPositionAxis="backgroundPosition"===this.property?c.property:null,this.reverseDirection=c.reverseDirection,this.speed=c.speed||1,this.delay=c.delay,this.stopAtValue=c.stopAtValue,this.originalVal=c.originalVal,this.propertyValueFormat=c.propertyValueFormat,this.afterStop=c.afterStop||a.noop,this.onPause=c.onPause||a.noop,this.onStart=c.onStart||a.noop,this.onDestroy=c.onDestroy||a.noop,this.$win=a(f),this.$doc=a(document),this.$context=a(this.context),this.lastScrollY=this.getScrollY(),this.isQueued=!1,this.paused=!1,this.stopped=!1,this.destroyed=!1,this.resizeTicker=0,this.lastFrameWasAnimated=!1,f.requestAnimationFrame=f.requestAnimationFrame||f.webkitRequestAnimationFrame||f.mozRequestAnimationFrame,this.raf=!!f.requestAnimationFrame,c.manualInit||this.init()}function c(a){var b=f.getComputedStyle(a,null);if(a&&b){var c=b.getPropertyValue("-webkit-transform")||b.getPropertyValue("-moz-transform")||b.getPropertyValue("-ms-transform")||b.getPropertyValue("-o-transform")||b.getPropertyValue("transform"),d=c.replace(/[matrix\(\)]/g,"").split(","),e=d[0],g=d[1],h=(d[2],d[3],d[4]),i=d[5],j=Math.sqrt(e*e+g*g),k=Math.round(Math.atan2(g,e)*(180/Math.PI));return{rotate:parseInt(k),scale:j,translateX:parseInt(h),translateY:parseInt(i)}}}var d,e,f=window,g={},h=0,i=["translateX","translateY","rotate","scale"],j=["backgroundPositionY","backgroundPositionX"],k=["-ms-","-webkit-"];a.extend(b.prototype,{init:function(){var a=this;this.destroyed=!1,this.isFixed="fixed"==this.$el.css("position"),this.originalVal=void 0!==this.originalVal?this.originalVal:this.calculateOriginalVal(),this.propertyValueFormat="function"==typeof this.propertyValueFormat?this.propertyValueFormat:this.transform||this.backgroundPositionAxis?this.getSpecialPropertyValueFormat(this.transform||this.backgroundPositionAxis):null,this.calculatedDelay=this.calculateDelay(),this.staticTransformValue=this.getStaticTransformValue(),this.canAnimate()&&this.animate(),this.$context.on(this.evt,this.scrollHandler.bind(this)),this.$win.on("resize",function(){a.resizeTicker++,a.resetPosition(a.resizeTicker)})},scrollHandler:function(){this.lastScrollY=this.getScrollY(),this.requestAnimation()},requestAnimation:function(){var a=this.$win.height()+this.lastScrollY>this.$doc.height();if(!a)return this.canAnimate()?this.raf?void(this.isQueued||(f.requestAnimationFrame(this.animate.bind(this)),this.isQueued=!0)):void this.animate():(this.lastFrameWasAnimated&&this.animateTo(this.originalVal),void(this.lastFrameWasAnimated=!1))},canAnimate:function(){var a=this.container||this.el,b=this.elementIsInView(a,800),c=this.destroyed||this.paused||!b&&!this.animateWhenOutOfView&&!this.isFixed||this.lastScrollY<this.calculatedDelay;return!c},animate:function(){this.isQueued=!1,this.lastFrameWasAnimated||this.onStart(this.el);var a=this.calculateMoveValue();this.propertyValueFormat&&(a=this.propertyValueFormat(this.$el[0],a)),this.updatePropertyValue(a),this.stopped&&this.checkforRestart(),this.lastFrameWasAnimated=!0},animateTo:function(a){this.originalVal=[a],this.propertyValueFormat&&(a=this.propertyValueFormat(this.el,a)),this.updatePropertyValue(a)},getScrollY:function(){return this.$context.scrollTop()},updatePropertyValue:function(b){var c=this;if(this.transform){var d={transform:c.staticTransformValue+" "+b};a.each(k,function(a,e){d[e+"transform"]=c.staticTransformValue+" "+b}),this.$el.css(d)}else this.$el.css(this.property,b)},getStaticTransformValue:function(){var a="",b=c(this.el);for(var d in b){var e=this.getSpecialPropertyValueFormat(d);b[d]&&d!==this.transform&&(a=a+" "+e(this.el,b[d]))}return a},getSpecialPropertyValueFormat:function(a){var b;switch(a){case"translateX":b=function(a,b){return"translateX("+b+"px)"};break;case"translateY":b=function(a,b){return"translateY("+b+"px)"};break;case"rotate":b=function(a,b){return"rotate("+b+"deg)"};break;case"scale":b=function(a,b){return"scale("+b+")"};break;case"backgroundPositionX":b=function(a,b){var c=getComputedStyle(a)?getComputedStyle(a).backgroundPosition.split(" ")[1]:0;return b+"px "+c};break;case"backgroundPositionY":b=function(a,b){var c=getComputedStyle(a)?getComputedStyle(a).backgroundPosition.split(" ")[0]:0;return c+" "+b+"px"};break;default:b=null}return b},calculateOriginalVal:function(){var a=this;if(!this.transform&&!this.backgroundPositionAxis)return parseInt(this.$el.css(this.property))||0;if(this.backgroundPositionAxis){var b=getComputedStyle(this.el)?getComputedStyle(this.el).backgroundPosition.split(" "):[0,0];return parseInt("backgroundPositionY"===this.backgroundPositionAxis?b[1]:b[0])}var d=c(a.el);return parseInt(d&&d[this.transform]?d[this.transform]:0)},calculateDelay:function(){var a=this.$el.offset().top;a=a>f.innerHeight&&!this.isFixed?a-f.innerHeight:0;var b="function"==typeof this.delay?this.delay(this.el):this.delay;return void 0===b?a:b+a},calculateMoveValue:function(){var a=(this.lastScrollY-this.calculatedDelay)*this.speed;return"scale"==this.transform&&(a=.01*a),a=this.reverseDirection?Number(this.originalVal)-a:Number(this.originalVal)+a,void 0!==this.stopAtValue&&(a=this.checkForStop(a)),"scale"==this.transform?a:Math.floor(a)},checkForStop:function(a){switch(this.originalVal<this.stopAtValue){case!0:a>=this.stopAtValue&&(a=this.stopAtValue,this.stopped=!0,this.afterStop(this.el));break;case!1:a<=this.stopAtValue&&(a=this.stopAtValue,this.afterStop(this.el),this.stopped=!0)}return a},checkforRestart:function(a){this.originalVal<this.stopAtValue&&a<=this.stopAtValue?this.stopped=!1:this.originalVal>this.stopAtValue&&a>=this.stopAtValue&&(this.stopped=!1)},elementIsInView:function(a,b){var c=document.body,d=document.documentElement,e=(Math.max(c.scrollHeight,d.scrollHeight,c.offsetHeight,d.offsetHeight,c.clientHeight,d.clientHeight),f.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),g=this.lastScrollY+e,h=a.offsetTop,i=a.clientHeight,j=g+b>=h&&h+i+e+b>g;return j},resetPosition:function(a){var b=this;setTimeout(function(){a==b.resizeTicker&&b.refresh()},500)},clearProperty:function(){var b=this;this.$el.css(this.property,""),this.transform&&a.each(k,function(a,c){b.$el.css(c+"transform","")})},pause:function(){this.paused=!0,this.originalVal=this.calculateOriginalVal(),this.onPause(this.el)},start:function(){this.paused=!1,this.onStart(this.el)},destroy:function(){this.destroyed=!0,this.$context.off(this.evt,this.scrollHandler),this.clearProperty(),delete g[this.id],this.onDestroy(this.el)},refresh:function(){this.clearProperty(),this.init()}}),d={destroy:function(){console.log("destroy all"),a.each(g,function(a,b){b.destroy()})},pause:function(){console.log("pause all"),a.each(g,function(a,b){b.pause()})},restart:function(){console.log("restart all"),a.each(g,function(a,b){b.start()})},refresh:function(){console.log("refresh all"),a.each(g,function(a,b){b.refresh()})}},e={destroy:function(){this.destroy()},pause:function(){this.pause()},restart:function(){this.start()},refresh:function(){this.refresh()}},a.fn.scrollTie=function(c){if("string"==typeof c){var d=c;return e[d]?e[d].apply(a(this).data().plugin_scrollTie):a.error(d?"ScrollTie does't recognize the method "+d:"ScrollTie needs a string reference to a public method or option configuration object.")}return this.each(function(){c.id="scrollTied"+h++,a.data(this,"plugin_scrollTie")||a.data(this,"plugin_scrollTie",g[c.id]=new b(this,c))})},a.scrollTie=function(){var a=arguments[0],b=2<=arguments.length?[].slice.call(arguments,1):[];return d[a]?d[a].apply(null,b):void 0}});